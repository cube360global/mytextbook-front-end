<div *ngIf="($loadingObs | async);else table" >
  <ngx-skeleton-loader  class="mt-5"  [count]="10"></ngx-skeleton-loader>
</div>
<ng-template #table>
  <div class="d-flex justify-content-between align-items-center mt-2">
    <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
  </div>
  <p-table
    #dt1
    [value]="users"
    [resizableColumns]="true"
    [paginator]="true"
    [rows]="5"
    [globalFilterFields]="['email','firstName','lastName','telephoneNumber','active','subscriptionCount','role']"
    [rowsPerPageOptions]="[5,10,25,50]"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    columnResizeMode="expand"
    styleClass="mt-2 p-datatable-sm p-datatable-striped p-datatable-gridlines">
    <ng-template pTemplate="caption">
      <div class="mb-2">
        <div class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input (input)="dt1.filterGlobal(searchInputData, 'contains')"
                 [(ngModel)]="searchInputData"
                 class="p-inputtext-sm"
                 matTooltip="Search from table"
                 pInputText
                 placeholder="Search keyword"
                 type="text"/>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pResizableColumn style="width: 250px"> Email</th>
        <th pResizableColumn>First Name</th>
        <th pResizableColumn>Last Name</th>
        <th pResizableColumn>Contact No</th>
        <th pResizableColumn>Status</th>
        <th pResizableColumn matTooltip="Subscription Count">Sub. Count</th>
        <th pResizableColumn>Role</th>
        <th pResizableColumn>Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{user.email}}</td>
        <td>{{user.firstName}}</td>
        <td>{{user.lastName}}</td>
        <td>{{user.telephoneNumber}}</td>
        <td (click)="onUserStatusEditClick(user)"
            matTooltip="Click to edit user status"
            style="cursor: pointer">
          <span *ngIf="user.active;else falseContent"
                class="alert alert-success p-1">
            Active
          </span>
        </td>
        <td>{{user.subscriptionCount}}</td>
        <td>{{user.role}}</td>
        <td>
          <button (click)="openUserViewDialog(user.id.toString())" color="primary"
                  mat-mini-fab matTooltip="View More">
            <i class="fas fa-eye"></i></button>
          <button (click)="openManageSubDialog(user)" class="ms-2" color="primary" mat-mini-fab
                  matTooltip="Add Subscription">
            <i class="fas fa-book-medical"></i>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</ng-template>
<ng-template #filterTemplate>
  <form (ngSubmit)="onFilterApply()" [formGroup]="filterForm">
    <div class="d-flex justify-content-center align-content-center">
      <p-dropdown
        [filter]="true"
        [options]="subjects"
        [showClear]="true"
        appendTo="body"
        filterBy="name"
        formControlName="subject"
        optionLabel="name"
        optionValue="name"
        placeholder="Select a Subject *"
        styleClass="p-inputtext-sm w-100 mt-1">

        <ng-template pTemplate="selectedItem">
          <div class="country-item country-item-value">
            <div>{{filterForm.controls['subject'].value}}</div>
          </div>
        </ng-template>

        <ng-template let-grade pTemplate="item">
          <div class="country-item">
            <div>{{grade.name}}</div>
          </div>
        </ng-template>
      </p-dropdown>

      <!--      <p-dropdown-->
      <!--        [filter]="true"-->
      <!--        [options]="schools"-->
      <!--        [showClear]="true" appendTo="body" filterBy="name"-->
      <!--        formControlName="school"-->
      <!--        optionLabel="name"-->
      <!--        placeholder="Select a School*"-->
      <!--        styleClass="p-inputtext-sm w-100">-->

      <!--        <ng-template pTemplate="selectedItem">-->
      <!--          <div class="country-item country-item-value">-->
      <!--            <div>{{filterForm.controls['subject'].value.name}}</div>-->
      <!--          </div>-->
      <!--        </ng-template>-->

      <!--        <ng-template let-grade pTemplate="item">-->
      <!--          <div class="country-item">-->
      <!--            <div>{{grade.name}}</div>-->
      <!--          </div>-->
      <!--        </ng-template>-->
      <!--      </p-dropdown>-->

      <div class="p-float-label m-1">
        <input class="p-inputtext-sm" formControlName="district" id="district" pInputText type="text">
        <label for="district">District</label>
      </div>
      <div class="p-float-label m-1">
        <input class="p-inputtext-sm" formControlName="school" id="school" pInputText type="text">
        <label for="school">School</label>
      </div>
      <!--      <div class="p-float-label m-1">-->
      <!--        <input class="p-inputtext-sm" formControlName="subject" id="subject" pInputText type="text">-->
      <!--        <label for="subject">Subject</label>-->
      <!--      </div>-->
      <div class="p-float-label m-1">
        <input class="p-inputtext-sm" formControlName="grade" id="grade" pInputText type="text">
        <label for="grade">Grade</label>
      </div>
      <div class="p-float-label m-1">
        <input class="p-inputtext-sm" formControlName="salesLead" id="salesLead" pInputText type="text">
        <label for="salesLead">Sales Lead</label>
      </div>
      <div class="text-center">
        <button class="mat-button-rounded m-1" color="primary" mat-raised-button>
          <i class="fas fa-search me-2"></i> Search
        </button>
      </div>
    </div>
  </form>
</ng-template>
<ng-template #falseContent>
  <span class="alert alert-danger p-1"> Inactive </span>
</ng-template>
